<!DOCTYPE html>
<html>
<head>
    <title>WebSocket Test</title>
</head>
<body>
    <h1>WebSocket Test</h1>
    <div id="log" style="font-family: monospace; white-space: pre-wrap;"></div>
    <script>
        const log = (msg) => {
            console.log(msg);
            document.getElementById('log').innerHTML += msg + '\n';
        };

        const ws = new WebSocket('ws://localhost:8080/?apiKey=lc_3e41d2f1276acdb315f02ee60f9fc013b0da996b43942c984be6dbc7836327cb');

        ws.onopen = () => {
            log('‚úÖ WebSocket connected');
            const connectMsg = {
                type: 'CONNECT',
                payload: {
                    userId: 'browser_test',
                    username: 'Browser Test',
                    roomId: 'lobby'
                }
            };
            log('üì§ Sending CONNECT: ' + JSON.stringify(connectMsg));
            ws.send(JSON.stringify(connectMsg));
        };

        ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
            log('üì® Received: ' + data.type);
            if (data.type === 'HISTORY') {
                log('‚úÖ HISTORY with ' + data.payload.messages.length + ' messages');
                log('üìù Messages: ' + JSON.stringify(data.payload.messages, null, 2));
            }
        };

        ws.onerror = (error) => log('‚ùå Error: ' + error);
        ws.onclose = () => log('‚ö†Ô∏è  Closed');
    </script>
</body>
</html>
